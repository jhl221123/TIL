# 외부설정

* 하나의 애플리케이션을 여러 다른 환경에서 사용하려면 외부에서 설정을 주입받아야 한다.
* 외부 설정 방법은 4가지가 있다.

### OS 환경 변수

 * 해당 OS를 사용하는 모든 프로세스에서 사용

#### 자바 시스템 속성

* 해당 JVM 안에서 사용
* `-D` VM 옵션을 통해 `key=value` 형식으로 지정
* `-jar` 보다 먼저 명시해야 한다.

#### 자바 커맨드 라인 인수
  * 커맨드 라인에서 전달하는 외부 설정, 실행시 `main(args)`으로 전달된다.
    * 필요한 데이터를 마지막 위치에 스페이스로 구분해서 전달
  * `key=value` 형식이 아니라 문자열이기 때문에 직접 파싱해야하는 번거로움이 있다.
  * 스프링은 편리한 사용을 위해 **커맨드 라인 옵션 인수**를 제공한다.
    * 인수 앞에 `--`를 붙여서 사용한다. 
    * `ApplicationArguments`를 통해 `key=value` 형식으로 변환된 애플리케이션 인수를 제공한다.

#### 외부 파일(설정 데이터)
  * 애플리케이션에서 외부 특정 위치의 파일을 읽도록 설정 해둔다.
  * 그리고 각 서버마다 해당 파일안에 다른 설정 정보를 남겨둔다.
    * 개발 서버: `hello.txt`: `url=dev.db.com`
    * 운영 서버: `hello.txt`: `url=prod.db.com`
  * 설정 파일을 매번 애플리케이션 외부에서 관리하는 것은 번거롭다.
    * 애플리케이션 내부에서 설정파일을 같이 관리할 수 있도록 지원
    * 적용할 환경 즉, 프로필만 외부에서 주입
    * 하나 이상의 프로필을 동시에 적용하는 것도 가능하다.
    * 위에서 아래로 읽으면서 프로필에 따라 변경되는 부분만 바뀌는 것처럼 적용된다.

## 스프링의 외부 설정 통합

`Environment`와 `PropertySource`를 통해 외부 설정을 추상화

* 각각의 외부 설정을 조회하는 `XxxPropertySource` 구현체(OS, JVM..)가 존재
* 스프링은 로딩 시점에 `PropertySource`들을 생성하고, `Environment`가 사용할 수 있도록 연결한다.
* `Environment`를 통해 특정 외부 설정에 종속되지 않고, 일관성 있게 `key=value` 형식에 접근할 수 있다.
  * 내부적으로 여러 과정을 거쳐 `PropertySource`들에 접근하며, 같은 값이 있다면 우선순위에 따라 적용된다.
  * 더 유연하고 범위가 좁은 것이 우선권을 가진다.
