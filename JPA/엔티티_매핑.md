# 엔티티 매핑

**정적인 클래스와 DB 테이블을 연결하는 작업**

### @Entity
* JAP가 관리하는 엔티티로 지정한다.
* JPA는 내부적으로 동적 기술을 사용하기 때문에 public 기본 생성자를 가지고 있어야 한다.
    * GCLIB이 상속을 사용하기 때문에 protected도 사용할 수 있다.
* final 클래스와 필드는 사용할 수 없다.
* enum, interface, inner 클래스는 사용할 수 없다.
* 엔티티 설계는 데이터 중심이 아닌, **연관관계 매핑을 통해 객체 중심적**으로 해야한다.

### @Column
* 컬럼 매핑
* 컬럼 정보나 제약조건을 설정

### @Enumerated
* 애플리케이션 Enum 타입을 DB와 매핑하기 위해 사용
* 기본값이 ORDINAL이지만 반드시 STRING을 사용하도록 하자.
    * ORDINAL은 순번으로 저장하기 때문에 필드 순서가 변경되면 데이터 정합성이 깨진다.

### @Id
* DB 기본키를 매핑, 비즈니스와 관련 없는 정보를 사용해야 한다.
* 기본키 생성전략은 Identity, Sequence 전략을 권장
    * 저장 시점에 기본 키를 모르는 상태이기 때문에 영속성 컨텍스트에 저장하기 전에 DB에 접근한다.

#### Identity 전략
* 예외적으로 persist() 메서드를 호출하면, 버퍼에 저장되지 않고 바로 insert 쿼리가 발생한다.
* DB에서 생성된 기본 키는 jdbc 드라이버가 내부적으로 확보하고, 영속성 컨텍스트에 엔티티를 저장한다.

#### Sequence 전략
* call 명령어를 사용해 sequence 테이블에서 현재 순번을 조회
* allocationSize를 사용해 한 번에 가져올 크기를 지정해 둘 수 있다.
    * 가져온 만큼 DB의 순번 크기가 증가하기 때문에 웹서버가 여러 개라도 문제 없이 사용가능하다.