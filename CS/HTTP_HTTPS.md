# HTTP

인터넷 상에서 클라이언트와 서버가 자원을 주고 받을 때 사용하는 통신 규약

평문 그대로 통신하기 때문에 보안문제가 발생할 수 있다.

![Alt text](<이미지/HTTP 통신.png>)

보안문제를 해결하기 위해 HTTPS를 사용한다.

# HTTPS

HTTP에서 보안성이 강화된 통신 규약

SSL(TLS) 프로토콜을 사용해서 클라이언트와 서버가 통신하는 정보를 암호화한다.

![Alt text](<이미지/HTTPS 통신.png>)

SSL 통신은 하이브리드 방식을 사용해서 대칭키를 안전하게 전달하고, 디지털 서명으로 공개키의 신뢰성을 확보할 수 있도록 한다.

## HTTPS(SSL) 통신 흐름

HTTPS를 사용하려는 기업은 CA(Certification Authority)에 기업정보와 공개키를 전달하고, 인증서 발급을 신청해야 한다. 심사결과 문제가 없다면, CA는 해당 기업의 정보와 공개키로 인증서를 만들고 CA 비밀키로 암호화한 후 해당 기업에게 전달한다.

![Alt text](<이미지/인증서 발급 과정.png>)

CA는 해당 공개키가 진짜 공개키인 것을 보증하기 위해 디지털 서명을 인증서에 포함시킨다.

> CA란?<br>
신뢰할 수 있는 제 3의 인증기관

### 디지털 서명

공개키로 암호화된 정보는 같은 쌍의 비밀키로 복호화할 수 있다. 만약 악의를 가진 누군가가 자신의 공개키를 공개할 경우, 해당 공개키로 암호화한 모든 정보를 복호화할 수 있게 된다.

![Alt text](<이미지/디지털 서명 필요성.png>)

따라서 전달받은 공개키가 진짜인지 확인할 수 있어야 하는데, 이때 사용하는 것이 디지털 서명이다. 디지털 서명은 인증서를 신청한 기업의 정보를 해시값으로 변환하고, 해시값을 CA의 비밀키로 암호화해서 만든다.

공개키의 신뢰성은 다음 과정으로 확보된다.

![Alt text](<이미지/디지털 서명.png>)

1. 기업정보를 해시값으로 변환하고, CA 비밀키로 암호화해서 디지털 서명을 만든다.

2. 암호화된 인증서를 받은 브라우저는 CA 공개키로 복호화해서 인증서를 확보하고,  인증서에 포함된 디지털 서명을 복호화 한다.

3. 인증서에 있는 정보의 해시값을 구한다.

4. 2와 3과정에서 구한 두 가지 값이 동일하다면, 해당 인증서에 포함된 공개키가 진짜 공개키라고 확신할 수 있다.

HTTPS 통신을 하는 사이트에 접속했을 때, 전체적인 과정은 다음과 같다.

![Alt text](<이미지/HTTPS 통신 흐름.png>)

1. 클라이언트(브라우저)에서 서버측으로 "client hello" 메시지를 전송한다. 이때 버전, 암호 알고리즘, 압축 방식 등 암호화된 정보를 함께 담는다.

2. 서버(N사)는 정보를 받고, 세션 ID와 암호화된 인증서를 server hello 메시지와 함께 응답한다. 브라우저는 미리 가지고 있던 CA 공개키로 인증서를 확보하고, 인증서 내에 있는 식별자로 CA 목록에 존재하지 확인한다.

3. 해당 CA가 목록에 존재하고, 디지털 서명을 통해 공개키의 신뢰성을 확보하고 나면 대칭키를 생성한다.

4. 서버의 공개키로 대칭키를 암호화해서 서버측으로 전달한다. 이때 부하를 줄이기 위해 대칭키 전체를 암호화하는 것이 아니라 기반이 되는 일부 정보만을 암호화한다.

5. 클라이언트측에서 연결 과정이 끝났다는 메시지와 함께 이제까지의 교환 내역을 대칭키로 암호화해서 서버측에 전달한다. 서버측에서는 전달받은 정보와 교환 내역을 비교해서 일치하면 마찬가지로 끝났다는 메시지를 대칭키로 암호화해서 전달한다.

6. 연결이 완료되면 클라이언트와 서버는 대칭키로 통신할 수 있게 된다. 통신이 끝나면 대칭키는 폐기된다.

## Chrome의 인증서

실제 Chrome의 인증서를 확인해 보면 인증서에 어떤 내용이 포함되어 있는지 확인할 수 있다.

![Alt text](<이미지/Chrome 인증서.png>)

브라우저에서 CA 목록으로 인증기관(CA)을 판별할 때 사용하는 식별자는 인증 기관 키 ID이다.