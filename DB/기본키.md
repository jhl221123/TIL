# 기본키(PK)

- 기본키는 레코드의 물리적 위치를 결정한다.
    - `NotNull`, `Unique` 한 특성을 가진다.
- MySQL은 PK가 유사한 레코드들끼리 묶어서 저장하며, 이를 클러스터링이라 한다.
  - PK를 기준으로 유사한 값들이 함께 조회되는 경우가 많다는 점을 고려
  - PK를 클러스터 인덱스라고 부르며, 그 외 인덱스는 논클러스터 인덱스라 부른다.
  - 클러스터링 특성 때문에 레코드 저장이나 PK 변경은 처리 속도가 느리다.
      - 레코드 추가: PK 기반으로 레코드가 저장되어야 하기 때문
      - PK 변경: 레코드가 저장된 물리적인 위치를 변경하는 작업이 수반된다.
      - 하지만 **커맨드성 작업보다 조회 작업이 8~9배 많기 때문에** 클러스터 인덱스를 사용한다.

## 클러스터링 테이블

- 클러스터 인덱스를 갖는 테이블
- MySQL에서 PK가 클러스터 인덱스이기 때문에 모든 테이블은 클러스터링 테이블이다.

### 저장 방식

- 인덱스처럼 별도의 자료구조에서 관리된다.
- 인덱스와 다르게 리프 노드에 실제 레코드의 모든 컬럼 값이 저장되어 있다.
    - key-value: 페이지 번호-레코드 데이터

### PK와 인덱스의 관계

- PK는 레코드의 물리적인 저장 위치를 결정한다.
    - 인덱스는 실제 저장 위치에 접근하기 위해 PK에 의존하게 된다.
    - 인덱스를 실제 주소와 바로 연결하게 되면, PK가 변경될 때마다 인덱스에 저장된 주소도 변경해야 한다.
      - 따라서 PK와 연결하는 것이 더 유리
- 인덱스가 PK를 의존하기 때문에 인덱스로 테이블에 접근하려면 2번의 작업을 거치게 된다.
    - 인덱스로 PK를 탐색
    - PK로 레코드가 저장된 페이지를 탐색
- 따라서 인덱스로 검색하는 것보다 PK로 검색하는 것이 더 빠르다.

### 페이지(블록)

디스크와 메모리에 데이터를 읽고 쓰는 최소 작업 단위

- 일반적인 인덱스, PK(클러스터 인덱스), 테이블 등은 모두 페이지 단위로 관리된다.
    - 조회하려는 데이터의 크기와 관계없이 실제 물리장치에서는 **페이지 단위로 조회**된다.
    - 각 데이터의 크기를 최대한 작게해서 하나의 페이지에 최대한 많은 데이터가 저장되도록 하는 것이 중요하다.
        - 각각의 데이터가 크다면 하나의 페이지만으로 작업을 처리할 수 없게 된다.
        - 이로인해 디스크 I/O가 많아지고 메모리에 캐시할 수 있는 페이지 수도 줄어들게 된다.